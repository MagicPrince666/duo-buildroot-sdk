#include <stdint.h>

static void set_rtc_register_for_power(void)
{
	printf("set_rtc_register_for_power\n");
	mmio_write_32(0x050260D0, 0x7);
}

int cvi_board_init(void)
{
	// Camera
	PINMUX_CONFIG(CAM_MCLK0, CAM_MCLK0);
	PINMUX_CONFIG(IIC3_SCL, IIC3_SCL);
	PINMUX_CONFIG(IIC3_SDA, IIC3_SDA);
	PINMUX_CONFIG(PAD_MIPIRX4P, XGPIOC_3);
	PINMUX_CONFIG(PAD_MIPIRX4N, XGPIOC_2);

	// DSI
	// PINMUX_CONFIG(PAD_MIPI_TXM4, MIPI_TXM4);
	// PINMUX_CONFIG(PAD_MIPI_TXP4, MIPI_TXP4);
	// PINMUX_CONFIG(PAD_MIPI_TXM3, MIPI_TXM3);
	// PINMUX_CONFIG(PAD_MIPI_TXP3, MIPI_TXP3);
	// PINMUX_CONFIG(PAD_MIPI_TXM2, MIPI_TXM2);
	// PINMUX_CONFIG(PAD_MIPI_TXP2, MIPI_TXP2);
	// PINMUX_CONFIG(PAD_MIPI_TXM1, MIPI_TXM1);
	// PINMUX_CONFIG(PAD_MIPI_TXP1, MIPI_TXP1);
	// PINMUX_CONFIG(PAD_MIPI_TXM0, MIPI_TXM0);
	// PINMUX_CONFIG(PAD_MIPI_TXP0, MIPI_TXP0);

	// I2C2 for Camera2
	PINMUX_CONFIG(IIC2_SDA, IIC2_SDA);
	PINMUX_CONFIG(IIC2_SCL, IIC2_SCL);

	// I2C4 for TP
	PINMUX_CONFIG(VIVO_D1, IIC4_SCL);
	PINMUX_CONFIG(VIVO_D0, IIC4_SDA);

	// SPI3
	PINMUX_CONFIG(VIVO_D8, SPI3_SDO);
	// uint32_t val = mmio_read_32(0x03001C08) & ~BIT(3);
	// mmio_write_32(0x03001C08, val | BIT(2));
	PINMUX_CONFIG(VIVO_D7, SPI3_SDI);
	// val = mmio_read_32(0x03001C0C) & ~BIT(3);
	// mmio_write_32(0x03001C0C, val | BIT(2));
	PINMUX_CONFIG(VIVO_D6, SPI3_SCK);
	// val = mmio_read_32(0x03001C10) & ~BIT(3);
	// mmio_write_32(0x03001C10, val | BIT(2));
	PINMUX_CONFIG(VIVO_D5, XGPIOB_16);
	// val = mmio_read_32(0x03001C14) & ~BIT(3);
	// mmio_write_32(0x03001C14, val | BIT(2));
	PINMUX_CONFIG(VIVO_D3, XGPIOB_18);
	// val = mmio_read_32(0x03001C1C) & ~BIT(3);
	// mmio_write_32(0x03001C1C, val | BIT(2));

	// backlight
	PINMUX_CONFIG(VIVO_D2, XGPIOB_19);

	// touch interupt
	PINMUX_CONFIG(VIVO_CLK, XGPIOB_22);

	// USB
	PINMUX_CONFIG(USB_VBUS_EN, XGPIOB_5);

	// UART2
	PINMUX_CONFIG(VIVO_D9, UART2_RX);
	PINMUX_CONFIG(VIVO_D10, UART2_TX);

	// WIFI/BT
	PINMUX_CONFIG(CLK32K, PWR_GPIO_10);
	PINMUX_CONFIG(CLK25M, PWR_GPIO_11);
	PINMUX_CONFIG(UART2_RX, UART4_RX);
	PINMUX_CONFIG(UART2_TX, UART4_TX);
	PINMUX_CONFIG(UART2_CTS, UART4_CTS);
	PINMUX_CONFIG(UART2_RTS, UART4_RTS);

	// GPIOs
	PINMUX_CONFIG(JTAG_CPU_TCK, XGPIOA_18); // mpu int
	PINMUX_CONFIG(JTAG_CPU_TMS, XGPIOA_19); // ctp rst
	PINMUX_CONFIG(JTAG_CPU_TRST, XGPIOA_20); // ctp int
	PINMUX_CONFIG(IIC0_SCL, XGPIOA_28); // lcd dc

	// LED
	PINMUX_CONFIG(IIC0_SDA, XGPIOA_29);

	PINMUX_CONFIG(ADC3, XGPIOB_1);
	PINMUX_CONFIG(ADC2, XGPIOB_2);
	PINMUX_CONFIG(ADC1, XGPIOB_3);

	// EPHY LEDs
	PINMUX_CONFIG(PWR_WAKEUP0, EPHY_LNK_LED);
	PINMUX_CONFIG(PWR_BUTTON1, EPHY_SPD_LED);

	set_rtc_register_for_power();

	return 0;
}


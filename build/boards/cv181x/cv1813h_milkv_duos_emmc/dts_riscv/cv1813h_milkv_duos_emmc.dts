/dts-v1/;
#include "cv181x_base_riscv.dtsi"
#include "cv181x_asic_bga.dtsi"
#include "cv181x_asic_emmc.dtsi"
#include "cv181x_default_memmap.dtsi"
#include <dt-bindings/gpio/gpio.h>

&mipi_rx{
	snsr-reset = <&porta 2 GPIO_ACTIVE_LOW>, <&porta 2 GPIO_ACTIVE_LOW>, <&porta 2 GPIO_ACTIVE_LOW>;
};

&ethernet0 {
	status = "okay";
	local-mac-address = [a4 51 29 00 00 b1];
};

&dac{
	/delete-property/ mute-gpio-l;
	/delete-property/ mute-gpio-r;
};

&i2c2 {
	status = "okay";
};

&i2c3 {
	status = "okay";
};

&i2c4 {
	status = "okay";

	gt9xx: gt9xx@5d {
		compatible = "goodix,gt911";
		reg = <0x5d>;
		interrupt-parent = <&porta>;
		interrupts = <20 IRQ_TYPE_EDGE_FALLING>;	// PA20
		irq-gpios = <&porta 20 IRQ_TYPE_LEVEL_LOW>;
		reset-gpios = <&porta 19 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
};

&spi3 {
	status = "okay";
	#address-cells = <1>;
	#size-cells = <0>;

	/delete-node/ spidev@0;

	spimux@0 {
		compatible = "spi-mux";
		reg = <0>;
		#address-cells = <1>;
		#size-cells = <0>;
		spi-max-frequency = <50000000>;

		mux-controls = <&mux>;

		display@0 {
			#address-cells = <1>;
			#size-cells = <0>;
			compatible = "ilitek,ili9341";
			reg = <0>;
			status = "okay";
			spi-max-frequency = <48000000>;
			rotation = <0>;
			fps = <30>;
			// spi-cpol;
			// spi-cpha;
			bgr;
			buswidth = <8>;

			dc = <&porta 28 GPIO_ACTIVE_HIGH>;
			reset = <&porta 18 GPIO_ACTIVE_HIGH>;

			debug = <0x0>;
			backlight = <&backlight>;
		};

		tsc2046@1 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <1>;
			compatible = "ti,tsc2046";
			interrupt-parent = <&portb>;
			interrupts = <22 IRQ_TYPE_EDGE_FALLING>;	// PB22
			spi-max-frequency = <1000000>;
			pendown-gpio = <&portb 22 GPIO_ACTIVE_HIGH>;
			vcc-supply = <&reg_vcc3v3>;

			touchscreen-size-x = <240>;
			touchscreen-size-y = <320>;

			ti,x-min = /bits/ 16 <0>;
			ti,x-max = /bits/ 16 <320>;
			ti,y-min = /bits/ 16 <0>;
			ti,y-max = /bits/ 16 <240>;
			ti,x-plate-ohms = /bits/ 16 <40>;
			ti,pressure-max = /bits/ 16 <255>;

			wakeup-source;
			status = "okay";
		};
	};
};

&usb {
	vbus-gpio = <&portb 6 0>;
};

&sd {
	status = "okay";
};

&wifisd {
	status = "okay";
	cap-sd-highspeed;
	sd-uhs-sdr25;
	sd-uhs-ddr50;
	sd-uhs-sdr104;
	min-frequency = <400000>;
	max-frequency = <187500000>;
};

&wifi_pin {
	compatible = "cvitek,wifi-pin";
	poweron-gpio = <&porta 15 GPIO_ACTIVE_HIGH>;
	wakeup-gpio = <&porte 7 GPIO_ACTIVE_HIGH>;
};

&uart2 {
	status = "okay";
};

&uart4 {
	status = "okay";
};

/* mipi dsi for u-boot */
&vo {
	compatible = "cvitek,vo";
	reset-gpio = <&portb 2 GPIO_ACTIVE_LOW>;
	pwm-gpio = <&porte 0 GPIO_ACTIVE_HIGH>;
	// power-gpio = <&portb 1 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

/* mipi dsi for kernel */
&mipi_tx {
	compatible = "cvitek,mipi_tx";
	reset-gpio = <&portb 2 GPIO_ACTIVE_LOW>;
	pwm-gpio = <&porte 0 GPIO_ACTIVE_HIGH>;
	power-ct-gpio = <&portb 1 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

/ {
	model = "Milk-V DuoS EMMC";

	/delete-node/ spi0@04180000;
	/delete-node/ spi1@04190000;
	/delete-node/ spi2@041A0000;
	/delete-node/ i2c0@04000000;
	/delete-node/ i2c1@04010000;
	/delete-node/ uart1@04150000;
	/delete-node/ uart3@04170000;

	aliases {
		spi3 = &spi3;
	};

	leds {
		compatible = "gpio-leds";
		status = "okay";

		status {
			label = "status";
			gpios = <&porta 29 GPIO_ACTIVE_HIGH>; /* PA29 */
			linux,default-trigger = "heartbeat";
			status = "okay";
		};
	};

	gpio_keys {
		compatible = "gpio-keys";
		#address-cells = <1>;
		#size-cells = <0>;

		button@0 {
			debounce-interval = <50>;
			wakeup-source;
			linux,code = <115>;
			label = "KEY0";
			gpios = <&portb 3 GPIO_ACTIVE_LOW>;
		};

		button@1 {
			debounce-interval = <50>;
			wakeup-source;
			linux,code = <116>;
			label = "KEY1";
			gpios = <&porte 2 GPIO_ACTIVE_LOW>;
		};

		button@2 {
			debounce-interval = <50>;
			wakeup-source;
			linux,code = <117>;
			label = "KEY2";
			gpios = <&porte 1 GPIO_ACTIVE_LOW>;
		};
	};

	reg_vcc3v3: vcc3v3 {
		compatible = "regulator-fixed";
		regulator-name = "vcc3v3";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
	};

	backlight: backlight {
		compatible = "gpio-backlight";
		gpios = <&portb 19 GPIO_ACTIVE_HIGH>; // PB19
		default-on;
	};

	bt_pin {
		compatible = "cvitek,bt-pin";
		poweron-gpio = <&porte 10 GPIO_ACTIVE_HIGH>;
	};

	mux: mux-controller {
        compatible = "gpio-mux";
        #mux-control-cells = <0>;

        mux-gpios = <&portb 18 GPIO_ACTIVE_HIGH>;
    };
};


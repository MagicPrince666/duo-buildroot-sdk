/dts-v1/;
#include "cv181x_base_riscv.dtsi"
#include "cv181x_asic_bga.dtsi"
#include "cv181x_asic_emmc.dtsi"
#include "cv181x_default_memmap.dtsi"

&mipi_rx{
	snsr-reset = <&porta 2 GPIO_ACTIVE_LOW>, <&porta 2 GPIO_ACTIVE_LOW>, <&porta 2 GPIO_ACTIVE_LOW>;
};

&dac{
	/delete-property/ mute-gpio-l;
	/delete-property/ mute-gpio-r;
};

&i2c0 {
	status = "disabled";
};

&i2c1 {
	status = "okay";
};

&i2c2 {
	status = "okay";
};

&i2c3 {
	status = "okay";
};

&i2c4 {
	status = "okay";

	gt9xx: gt9xx@14 {
		compatible = "goodix,gt9xx";
		reg = <0x14>;
		goodix,irq-gpio = <&porta 20 0>;
		goodix,rst-gpio = <&porta 19 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
};

&spi3 {
	status = "okay";
	cs-gpios = <&portb 16 GPIO_ACTIVE_HIGH>, <&portb 18 GPIO_ACTIVE_HIGH>; // PB16 PB18
	num-chipselects = <2>;

	display@0 {
			compatible = "ilitek,ili9341";
			reg = <0>;
			status = "okay";
			spi-max-frequency = <50000000>;
			rotation = <90>;
			fps = <30>;
			// spi-cpol;
			// spi-cpha;
			bgr;
			buswidth = <8>;

			dc-gpios = <&porta 28 GPIO_ACTIVE_HIGH>;
			reset-gpios = <&porta 18 GPIO_ACTIVE_HIGH>;

			debug = <0x0>;
			backlight = <&backlight>;
		};

		tsc2046@1 {
			reg = <1>;
			compatible = "ti,tsc2046";
			interrupt-parent = <&portb>;
			interrupts = <22 IRQ_TYPE_EDGE_FALLING>;	// PB22
			spi-max-frequency = <1000000>;
			pendown-gpio = <&portb 22 GPIO_ACTIVE_HIGH>;
			vcc-supply = <&reg_vcc3v3>;

			ti,x-min = /bits/ 16 <0>;
			ti,x-max = /bits/ 16 <320>;
			ti,y-min = /bits/ 16 <0>;
			ti,y-max = /bits/ 16 <240>;
			ti,x-plate-ohms = /bits/ 16 <40>;
			ti,pressure-max = /bits/ 16 <255>;

			wakeup-source;
			status = "okay";
		};
};

&usb {
	vbus-gpio = <&portb 6 0>;
};

&sd {
	status = "okay";
};

&wifisd {
	status = "okay";
	cap-sd-highspeed;
	sd-uhs-sdr25;
	sd-uhs-ddr50;
	sd-uhs-sdr104;
	min-frequency = <400000>;
	max-frequency = <187500000>;
};

&wifi_pin {
	compatible = "cvitek,wifi-pin";
	poweron-gpio = <&porta 15 GPIO_ACTIVE_HIGH>;
	wakeup-gpio = <&porte 7 GPIO_ACTIVE_HIGH>;
};

&uart1 {
	status = "disabled";
};

&uart2 {
	status = "okay";
};

&uart3 {
	status = "disabled";
};

&uart4 {
	status = "okay";
};

/* mipi dsi for u-boot */
&vo {
	compatible = "cvitek,vo";
	reset-gpio = <&porte 2 GPIO_ACTIVE_LOW>;
	pwm-gpio = <&porte 0 GPIO_ACTIVE_HIGH>;
	power-gpio = <&porte 1 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

/* mipi dsi for kernel */
&mipi_tx {
	compatible = "cvitek,mipi_tx";
	reset-gpio = <&porte 2 GPIO_ACTIVE_LOW>;
	pwm-gpio = <&porte 0 GPIO_ACTIVE_HIGH>;
	power-ct-gpio = <&porte 1 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

/ {
	model = "Milk-V DuoS EMMC";

	leds {
		compatible = "gpio-leds";
		status = "okay";

		status {
			label = "status";
			gpios = <&porta 29 GPIO_ACTIVE_HIGH>; /* PA29 */
			linux,default-trigger = "heartbeat";
			status = "okay";
		};
	};

	reg_vcc3v3: vcc3v3 {
		compatible = "regulator-fixed";
		regulator-name = "vcc3v3";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
	};

	backlight: backlight {
		compatible = "gpio-backlight";
		gpios = <&portb 19 GPIO_ACTIVE_HIGH>; // PB19
		default-on;
	};

	bt_pin {
		compatible = "cvitek,bt-pin";
		poweron-gpio = <&porte 10 GPIO_ACTIVE_HIGH>;
	};
};

